---
version: '3'

description: |
  task helper for helm

tasks:
  lint:
    cmds:
      - helm lint {{ .USER_WORKING_DIR }}
  template:
    vars:
      pipe_bat: '{{ default "false" .pipe_bat }}'
    cmds:
      - |
        [[ "true" == "{{ .pipe_bat }}" ]] && helm template {{ default "release-name" .release_name }} {{ .USER_WORKING_DIR }} | bat -P -lyaml
        [[ "false" == "{{ .pipe_bat }}" ]] && helm template {{ default "release-name" .release_name }} {{ .USER_WORKING_DIR }}
  dependencies:
    desc: installs helm dependencies
    vars:
      cleanup: '{{ default "true" .cleanup }}'
    cmds:
      - cmd: |
          [[ "true" == "{{ .cleanup }}" ]] && rm -rf {{ .USER_WORKING_DIR}}/charts {{ .USER_WORKING_DIR }}/Chart.lock
        ignore_error: true
      - cd {{ .USER_WORKING_DIR }} && helm dependency build
  default:
    cmds:
      - task: dependencies
      - task: lint
      - task: template
